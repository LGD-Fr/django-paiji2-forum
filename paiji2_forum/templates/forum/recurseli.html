{% comment %}

Copyright (C) 2015 Louis-Guillaume DUBOIS

This file is part of paiji2-forum

paiji2-forum is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

paiji2-forum is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

{% endcomment %}
{% load i18n %}
{% load static %}
{% load mptt_tags %}
{% load profile %}
<li>
    <div {% if node == message %}id="forum-message"{% elif node == question %}id="forum-question"{% endif %}>
        <a class="forum-message-title" href="{% url 'forum:message' node.pk %}#forum-message">
            <img class="forum-icon" src="{% static node.icon.url %}" alt="{{ node.icon.name }}"/>
            {{ node.title }}
        </a>
        <small> 
            <span class="label label-default label-sm" title="{% blocktrans count nb=node.readers.count %}one reading{% plural %}{{ nb }} readings{% endblocktrans %}">{{ node.readers.count }}</span>
        </small>
        {% profile_link node.author %}
        <small>
            {% if node.not_read or request.user not in node.readers.all %}
                <span class="label label-sm label-success">{% trans 'unread' context 'sing' %}</span>
            {% endif %}
            <span class="text-muted">{% blocktrans with TimeSince=node.pub_date|timesince %}{{ TimeSince }} ago{% endblocktrans %}</span>
        </small>
    </div>

    {% if message %}
        <div {% if node == message %}id="forum-message-text"{% elif node == message.question %}id="forum-question-text"{% endif %} class="well well-sm forum-text">
            <a class="pull-right" href="{% url 'forum:answer' node.pk %}#forum-answer">
            <small>
            <span class="glyphicon glyphicon-pencil"></span>
            {% trans 'answer' %}
            </small>
            </a>
            {{ node.text|urlize|linebreaks }}
        </div>
    {% endif %}

    <ul class="answers">

        {% if form and node == message %}
        <li class="form">
        <form id="forum-answer" action="{% url 'forum:answer' node.pk %}" method="post">
        {% csrf_token %}
        {% include 'forum/form.html' %}
        <button class="btn btn-primary btn-block" type="submit"/>
            {% trans 'publish the answer' %}
        </button>
        </form>
        </li>
        {% endif %}

        {% if not node.is_leaf_node %}
        {{ children }}
        {% endif %}

    </ul>
</li>
