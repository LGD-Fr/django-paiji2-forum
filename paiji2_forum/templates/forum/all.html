{% extends "forum/base.html" %}
{% comment %}

Copyright (C) 2015 Louis-Guillaume DUBOIS

This file is part of paiji2-forum

paiji2-forum is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

paiji2-forum is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

{% endcomment %}
{% load static %}
{% load i18n %}

{% block forum-top-nav %}

<ul class="pager">
    <li class="previous {% if not prev_topic %}disabled{% endif %}">
        <a {% if prev_topic %}href="{% url 'forum:message' prev_topic.pk %}#forum-message"{% endif %}>
        <span class="glyphicon glyphicon-arrow-left"></span>
        {% trans 'topic' %}
        </a>
    <li>
        <a id="forum-top" href="#forum-bottom">
            <span class="glyphicon glyphicon-arrow-down"></span>
            {% trans 'bottom' %}
        </a>
    </li>
    <li class="next {% if not next_topic %}disabled{% endif %}">
        <a {% if next_topic %}href="{% url 'forum:message' next_topic.pk %}#forum-message"{% endif %}>
        {% trans 'topic' %}
        <span class="glyphicon glyphicon-arrow-right"></span>
        </a>
    </li>
</ul>

{% endblock %}



{% block forum-content %}

{% for msg  in object_list %}

    {% block message-title %}

    <div {% if msg == message %}id="forum-message"{% elif msg == question %}id="forum-question"{% endif %} {% block entry-class %}class ="{%if msg.is_topic %}topic-entry {% endif %}forum-entry"{% endblock %} {% block padding %}style="margin-left: {{ msg.padding }}px;"{% endblock %}>
        <a class="forum-message-title" href="{% url 'forum:message' msg.pk %}#forum-message">
            <img class="forum-icon" src="{% static msg.icon.url %}" alt="{{ msg.icon.name }}"/>
            {{ msg.title }}
        </a>
        <small> 
            <span class="label label-default label-sm" title="{% blocktrans count nb=msg.readers.count %}one reading{% plural %}{{ nb }} readings{% endblocktrans %}">{{ msg.readers.count }}</span>
            {% if not msg.is_read %}
            <span class="label label-sm label-success">{% trans 'unread' context 'sing' %}</span>
            {% endif %}
            <a class="forum-author"
            {% if expand %}
            href="{% url 'forum:topic' msg.pk %}#forum-message"
            {% else %}
            href="{% url 'forum:message' msg.pk %}#forum-message"
            {% endif %}
            title="{{ msg.author.first_name }} {{ msg.author.last_name }} ({{ msg.author }})">
                {% if msg.author.first_name %}
                {{ msg.author.first_name }}
                {% else %}
                {{ msg.author }}
                {% endif %}
            </a>
            <span class="text-muted">{% blocktrans with TimeSince=msg.pub_date|timesince %}{{ TimeSince }} ago{% endblocktrans %}</span>
        </small>

        {% block topic-name %}
        <span class="text-muted"> [{% trans 'topic' %} : </span><span class="forum-message-title">{{ msg.topic }}</a><span class="text-muted"> ]</span>
        {% endblock %}

    {% endblock %}


    {% block text %}

    <div {% if msg == message %}id="forum-message-text"{% elif msg == question %}id="forum-question-text"{% endif %} class="well well-sm forum-text">
        <a class="pull-right" href="{% url 'forum:answer' msg.pk %}#forum-answer">
        <small>
        <span class="glyphicon glyphicon-pencil"></span>
        {% trans 'answer' %}
        </small>
        </a>
        {{ msg.text|urlize|linebreaks }}
    </div>

    {% endblock %}

    {% if msg == message %}

    {% block form %}
    
        <form id="forum-answer" action="{% url 'forum:answer' msg.pk %}" method="post">

        {% csrf_token %}

        {% include 'forum/form.html' %}

        <button class="btn btn-primary btn-block" type="submit"/>
            {% trans 'publish the answer' %}
        </button>

        </form>
            
    {% endblock %}

    {% endif %}

</div>

{% empty %}
    
    <span class="label label-default">{% trans 'no message' %}</span>

{% endfor %}

{% endblock %}



{% block forum-bottom-nav %}

<ul class="pager">
    <li class="previous {% if not prev_topic %}disabled{% endif %}">
        <a {% if prev_topic %}href="{% url 'forum:message' prev_topic.pk %}#forum-message"{% endif %}>
        <span class="glyphicon glyphicon-arrow-left"></span>
        {% trans 'topic' %}
        </a>
    <li>
        <a id="forum-bottom" href="#forum-top">
            <span class="glyphicon glyphicon-arrow-up"></span>
            {% trans 'top' %}
        </a>
    </li>
    <li class="next {% if not next_topic %}disabled{% endif %}">
        <a {% if next_topic %}href="{% url 'forum:message' next_topic.pk %}#forum-message"{% endif %}>
        {% trans 'topic' %}
        <span class="glyphicon glyphicon-arrow-right"></span>
        </a>
    </li>
</ul>

{% endblock %}


